close all;
clear;
clc

s.coord  = [-1 -1 -1;
                +1 -1 -1;
                +1 +1 -1;
                -1 +1 -1;
                -1 -1 +1;
                +1 -1 +1;
                +1 +1 +1;
                -1 +1 +1];
s.connec = [1 2 3 4 5 6 7 8];
mesh = Mesh(s);

sAF.fHandle = @(x) x(1,:,:);
sAF.ndimf   = 1;
sAF.mesh    = mesh;
xFun = AnalyticalFunction(sAF);

% p1fun = xFun.project('P1');
% p2fun = xFun.project('P2');
p3fun = xFun.project('P3');

%%
tfgP2 = [0         0         0
    0.5000         0         0
    1.0000         0         0
         0    0.5000         0
    0.5000    0.5000         0
    1.0000    0.5000         0
         0    1.0000         0
    0.5000    1.0000         0
    1.0000    1.0000         0
         0         0    0.5000
    0.5000         0    0.5000
    1.0000         0    0.5000
         0    0.5000    0.5000
    0.5000    0.5000    0.5000
    1.0000    0.5000    0.5000
         0    1.0000    0.5000
    0.5000    1.0000    0.5000
    1.0000    1.0000    0.5000
         0         0    1.0000
    0.5000         0    1.0000
    1.0000         0    1.0000
         0    0.5000    1.0000
    0.5000    0.5000    1.0000
    1.0000    0.5000    1.0000
         0    1.0000    1.0000
    0.5000    1.0000    1.0000
    1.0000    1.0000    1.0000];

P2 = [-1 -1 -1;
        +1 -1 -1;
        +1 +1 -1;
        -1 +1 -1;
        -1 -1 +1;
        +1 -1 +1;
        +1 +1 +1;
        -1 +1 +1;
         0 -1 -1;
        -1  0 -1;
        -1 -1  0;
        +1  0 -1;
        +1 -1  0;
         0 +1 -1;
        +1 +1  0;
        -1 +1  0;
         0 -1 +1;
        -1  0 +1;
        +1  0 +1;
         0 +1 +1;
         0  0 -1;
         0 -1  0;
        -1  0  0;
        +1  0  0;
         0 +1  0;
         0  0 +1;
         0  0  0];  
     
P2i = (P2+1)*0.5;

indP2 = [1
     3
     9
     7
    19
    21
    27
    25
     2
     4
    10
     6
    12
     8
    18
    16
    20
    22
    24
    26
     5
    11
    13
    15
    17
    23
    14]';

for i = 1:27
    ind(i) = find(ismember(tfgP2, P2i(i,:),'rows'));
end

s = tfgP2(:,1)';
t = tfgP2(:,2)';
u = tfgP2(:,3)';

shapes = [s.*-3.0-t.*3.0-u.*3.0+s.^2.*t.^2.*4.0+s.^2.*u.^2.*4.0+t.^2.*u.^2.*4.0+s.*t.*9.0+s.*u.*9.0+t.*u.*9.0-s.*t.^2.*6.0-s.^2.*t.*6.0-s.*u.^2.*6.0-s.^2.*u.*6.0-t.*u.^2.*6.0-t.^2.*u.*6.0+s.^2.*2.0+t.^2.*2.0+u.^2.*2.0+s.*t.*u.^2.*1.8e+1+s.*t.^2.*u.*1.8e+1+s.^2.*t.*u.*1.8e+1-s.*t.^2.*u.^2.*1.2e+1-s.^2.*t.*u.^2.*1.2e+1-s.^2.*t.^2.*u.*1.2e+1-s.*t.*u.*2.7e+1+s.^2.*t.^2.*u.^2.*8.0+1.0;
s.*4.0-s.^2.*t.^2.*8.0-s.^2.*u.^2.*8.0-s.*t.*1.2e+1-s.*u.*1.2e+1+s.*t.^2.*8.0+s.^2.*t.*1.2e+1+s.*u.^2.*8.0+s.^2.*u.*1.2e+1-s.^2.*4.0-s.*t.*u.^2.*2.4e+1-s.*t.^2.*u.*2.4e+1-s.^2.*t.*u.*3.6e+1+s.*t.^2.*u.^2.*1.6e+1+s.^2.*t.*u.^2.*2.4e+1+s.^2.*t.^2.*u.*2.4e+1+s.*t.*u.*3.6e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
-s+s.^2.*t.^2.*4.0+s.^2.*u.^2.*4.0+s.*t.*3.0+s.*u.*3.0-s.*t.^2.*2.0-s.^2.*t.*6.0-s.*u.^2.*2.0-s.^2.*u.*6.0+s.^2.*2.0+s.*t.*u.^2.*6.0+s.*t.^2.*u.*6.0+s.^2.*t.*u.*1.8e+1-s.*t.^2.*u.^2.*4.0-s.^2.*t.*u.^2.*1.2e+1-s.^2.*t.^2.*u.*1.2e+1-s.*t.*u.*9.0+s.^2.*t.^2.*u.^2.*8.0;
t.*4.0-s.^2.*t.^2.*8.0-t.^2.*u.^2.*8.0-s.*t.*1.2e+1-t.*u.*1.2e+1+s.*t.^2.*1.2e+1+s.^2.*t.*8.0+t.*u.^2.*8.0+t.^2.*u.*1.2e+1-t.^2.*4.0-s.*t.*u.^2.*2.4e+1-s.*t.^2.*u.*3.6e+1-s.^2.*t.*u.*2.4e+1+s.*t.^2.*u.^2.*2.4e+1+s.^2.*t.*u.^2.*1.6e+1+s.^2.*t.^2.*u.*2.4e+1+s.*t.*u.*3.6e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.^2.*t.^2.*1.6e+1+s.*t.*1.6e+1-s.*t.^2.*1.6e+1-s.^2.*t.*1.6e+1+s.*t.*u.^2.*3.2e+1+s.*t.^2.*u.*4.8e+1+s.^2.*t.*u.*4.8e+1-s.*t.^2.*u.^2.*3.2e+1-s.^2.*t.*u.^2.*3.2e+1-s.^2.*t.^2.*u.*4.8e+1-s.*t.*u.*4.8e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
s.^2.*t.^2.*-8.0-s.*t.*4.0+s.*t.^2.*4.0+s.^2.*t.*8.0-s.*t.*u.^2.*8.0-s.*t.^2.*u.*1.2e+1-s.^2.*t.*u.*2.4e+1+s.*t.^2.*u.^2.*8.0+s.^2.*t.*u.^2.*1.6e+1+s.^2.*t.^2.*u.*2.4e+1+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
-t+s.^2.*t.^2.*4.0+t.^2.*u.^2.*4.0+s.*t.*3.0+t.*u.*3.0-s.*t.^2.*6.0-s.^2.*t.*2.0-t.*u.^2.*2.0-t.^2.*u.*6.0+t.^2.*2.0+s.*t.*u.^2.*6.0+s.*t.^2.*u.*1.8e+1+s.^2.*t.*u.*6.0-s.*t.^2.*u.^2.*1.2e+1-s.^2.*t.*u.^2.*4.0-s.^2.*t.^2.*u.*1.2e+1-s.*t.*u.*9.0+s.^2.*t.^2.*u.^2.*8.0;
s.^2.*t.^2.*-8.0-s.*t.*4.0+s.*t.^2.*8.0+s.^2.*t.*4.0-s.*t.*u.^2.*8.0-s.*t.^2.*u.*2.4e+1-s.^2.*t.*u.*1.2e+1+s.*t.^2.*u.^2.*1.6e+1+s.^2.*t.*u.^2.*8.0+s.^2.*t.^2.*u.*2.4e+1+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.^2.*t.^2.*4.0+s.*t-s.*t.^2.*2.0-s.^2.*t.*2.0+s.*t.*u.^2.*2.0+s.*t.^2.*u.*6.0+s.^2.*t.*u.*6.0-s.*t.^2.*u.^2.*4.0-s.^2.*t.*u.^2.*4.0-s.^2.*t.^2.*u.*1.2e+1-s.*t.*u.*3.0+s.^2.*t.^2.*u.^2.*8.0;
u.*4.0-s.^2.*u.^2.*8.0-t.^2.*u.^2.*8.0-s.*u.*1.2e+1-t.*u.*1.2e+1+s.*u.^2.*1.2e+1+s.^2.*u.*8.0+t.*u.^2.*1.2e+1+t.^2.*u.*8.0-u.^2.*4.0-s.*t.*u.^2.*3.6e+1-s.*t.^2.*u.*2.4e+1-s.^2.*t.*u.*2.4e+1+s.*t.^2.*u.^2.*2.4e+1+s.^2.*t.*u.^2.*2.4e+1+s.^2.*t.^2.*u.*1.6e+1+s.*t.*u.*3.6e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.^2.*u.^2.*1.6e+1+s.*u.*1.6e+1-s.*u.^2.*1.6e+1-s.^2.*u.*1.6e+1+s.*t.*u.^2.*4.8e+1+s.*t.^2.*u.*3.2e+1+s.^2.*t.*u.*4.8e+1-s.*t.^2.*u.^2.*3.2e+1-s.^2.*t.*u.^2.*4.8e+1-s.^2.*t.^2.*u.*3.2e+1-s.*t.*u.*4.8e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
s.^2.*u.^2.*-8.0-s.*u.*4.0+s.*u.^2.*4.0+s.^2.*u.*8.0-s.*t.*u.^2.*1.2e+1-s.*t.^2.*u.*8.0-s.^2.*t.*u.*2.4e+1+s.*t.^2.*u.^2.*8.0+s.^2.*t.*u.^2.*2.4e+1+s.^2.*t.^2.*u.*1.6e+1+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
t.^2.*u.^2.*1.6e+1+t.*u.*1.6e+1-t.*u.^2.*1.6e+1-t.^2.*u.*1.6e+1+s.*t.*u.^2.*4.8e+1+s.*t.^2.*u.*4.8e+1+s.^2.*t.*u.*3.2e+1-s.*t.^2.*u.^2.*4.8e+1-s.^2.*t.*u.^2.*3.2e+1-s.^2.*t.^2.*u.*3.2e+1-s.*t.*u.*4.8e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
s.*t.*u.^2.*-6.4e+1-s.*t.^2.*u.*6.4e+1-s.^2.*t.*u.*6.4e+1+s.*t.^2.*u.^2.*6.4e+1+s.^2.*t.*u.^2.*6.4e+1+s.^2.*t.^2.*u.*6.4e+1+s.*t.*u.*6.4e+1-s.^2.*t.^2.*u.^2.*6.4e+1;
s.*t.*u.^2.*1.6e+1+s.*t.^2.*u.*1.6e+1+s.^2.*t.*u.*3.2e+1-s.*t.^2.*u.^2.*1.6e+1-s.^2.*t.*u.^2.*3.2e+1-s.^2.*t.^2.*u.*3.2e+1-s.*t.*u.*1.6e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
t.^2.*u.^2.*-8.0-t.*u.*4.0+t.*u.^2.*4.0+t.^2.*u.*8.0-s.*t.*u.^2.*1.2e+1-s.*t.^2.*u.*2.4e+1-s.^2.*t.*u.*8.0+s.*t.^2.*u.^2.*2.4e+1+s.^2.*t.*u.^2.*8.0+s.^2.*t.^2.*u.*1.6e+1+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.*t.*u.^2.*1.6e+1+s.*t.^2.*u.*3.2e+1+s.^2.*t.*u.*1.6e+1-s.*t.^2.*u.^2.*3.2e+1-s.^2.*t.*u.^2.*1.6e+1-s.^2.*t.^2.*u.*3.2e+1-s.*t.*u.*1.6e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
s.*t.*u.^2.*-4.0-s.*t.^2.*u.*8.0-s.^2.*t.*u.*8.0+s.*t.^2.*u.^2.*8.0+s.^2.*t.*u.^2.*8.0+s.^2.*t.^2.*u.*1.6e+1+s.*t.*u.*4.0-s.^2.*t.^2.*u.^2.*1.6e+1;
-u+s.^2.*u.^2.*4.0+t.^2.*u.^2.*4.0+s.*u.*3.0+t.*u.*3.0-s.*u.^2.*6.0-s.^2.*u.*2.0-t.*u.^2.*6.0-t.^2.*u.*2.0+u.^2.*2.0+s.*t.*u.^2.*1.8e+1+s.*t.^2.*u.*6.0+s.^2.*t.*u.*6.0-s.*t.^2.*u.^2.*1.2e+1-s.^2.*t.*u.^2.*1.2e+1-s.^2.*t.^2.*u.*4.0-s.*t.*u.*9.0+s.^2.*t.^2.*u.^2.*8.0;
s.^2.*u.^2.*-8.0-s.*u.*4.0+s.*u.^2.*8.0+s.^2.*u.*4.0-s.*t.*u.^2.*2.4e+1-s.*t.^2.*u.*8.0-s.^2.*t.*u.*1.2e+1+s.*t.^2.*u.^2.*1.6e+1+s.^2.*t.*u.^2.*2.4e+1+s.^2.*t.^2.*u.*8.0+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.^2.*u.^2.*4.0+s.*u-s.*u.^2.*2.0-s.^2.*u.*2.0+s.*t.*u.^2.*6.0+s.*t.^2.*u.*2.0+s.^2.*t.*u.*6.0-s.*t.^2.*u.^2.*4.0-s.^2.*t.*u.^2.*1.2e+1-s.^2.*t.^2.*u.*4.0-s.*t.*u.*3.0+s.^2.*t.^2.*u.^2.*8.0;
t.^2.*u.^2.*-8.0-t.*u.*4.0+t.*u.^2.*8.0+t.^2.*u.*4.0-s.*t.*u.^2.*2.4e+1-s.*t.^2.*u.*1.2e+1-s.^2.*t.*u.*8.0+s.*t.^2.*u.^2.*2.4e+1+s.^2.*t.*u.^2.*1.6e+1+s.^2.*t.^2.*u.*8.0+s.*t.*u.*1.2e+1-s.^2.*t.^2.*u.^2.*1.6e+1;
s.*t.*u.^2.*3.2e+1+s.*t.^2.*u.*1.6e+1+s.^2.*t.*u.*1.6e+1-s.*t.^2.*u.^2.*3.2e+1-s.^2.*t.*u.^2.*3.2e+1-s.^2.*t.^2.*u.*1.6e+1-s.*t.*u.*1.6e+1+s.^2.*t.^2.*u.^2.*3.2e+1;
s.*t.*u.^2.*-8.0-s.*t.^2.*u.*4.0-s.^2.*t.*u.*8.0+s.*t.^2.*u.^2.*8.0+s.^2.*t.*u.^2.*1.6e+1+s.^2.*t.^2.*u.*8.0+s.*t.*u.*4.0-s.^2.*t.^2.*u.^2.*1.6e+1;
t.^2.*u.^2.*4.0+t.*u-t.*u.^2.*2.0-t.^2.*u.*2.0+s.*t.*u.^2.*6.0+s.*t.^2.*u.*6.0+s.^2.*t.*u.*2.0-s.*t.^2.*u.^2.*1.2e+1-s.^2.*t.*u.^2.*4.0-s.^2.*t.^2.*u.*4.0-s.*t.*u.*3.0+s.^2.*t.^2.*u.^2.*8.0;
s.*t.*u.^2.*-8.0-s.*t.^2.*u.*8.0-s.^2.*t.*u.*4.0+s.*t.^2.*u.^2.*1.6e+1+s.^2.*t.*u.^2.*8.0+s.^2.*t.^2.*u.*8.0+s.*t.*u.*4.0-s.^2.*t.^2.*u.^2.*1.6e+1;
s.*t.*u.^2.*2.0+s.*t.^2.*u.*2.0+s.^2.*t.*u.*2.0-s.*t.^2.*u.^2.*4.0-s.^2.*t.*u.^2.*4.0-s.^2.*t.^2.*u.*4.0-s.*t.*u+s.^2.*t.^2.*u.^2.*8.0];