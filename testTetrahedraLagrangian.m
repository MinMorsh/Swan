close all;
clear;
clc

s.coord  = [-1 -1 -1;
                +1 -1 -1;
                +1 +1 -1;
                -1 +1 -1;
                -1 -1 +1;
                +1 -1 +1;
                +1 +1 +1;
                -1 +1 +1];
s.connec = [1 2 3 4 5 6 7 8];
mesh = Mesh(s);

sAF.fHandle = @(x) x(1,:,:);
sAF.ndimf   = 1;
sAF.mesh    = mesh;
xFun = AnalyticalFunction(sAF);

% p1fun = xFun.project('P1');
% p2fun = xFun.project('P2');
p3fun = xFun.project('P3');

%%
tfgP2 = [0         0         0
    0.5000         0         0
    1.0000         0         0
         0    0.5000         0
    0.5000    0.5000         0
    1.0000    0.5000         0
         0    1.0000         0
    0.5000    1.0000         0
    1.0000    1.0000         0
         0         0    0.5000
    0.5000         0    0.5000
    1.0000         0    0.5000
         0    0.5000    0.5000
    0.5000    0.5000    0.5000
    1.0000    0.5000    0.5000
         0    1.0000    0.5000
    0.5000    1.0000    0.5000
    1.0000    1.0000    0.5000
         0         0    1.0000
    0.5000         0    1.0000
    1.0000         0    1.0000
         0    0.5000    1.0000
    0.5000    0.5000    1.0000
    1.0000    0.5000    1.0000
         0    1.0000    1.0000
    0.5000    1.0000    1.0000
    1.0000    1.0000    1.0000];

P2 = [-1 -1 -1;
        +1 -1 -1;
        +1 +1 -1;
        -1 +1 -1;
        -1 -1 +1;
        +1 -1 +1;
        +1 +1 +1;
        -1 +1 +1;
         0 -1 -1;
        -1  0 -1;
        -1 -1  0;
        +1  0 -1;
        +1 -1  0;
         0 +1 -1;
        +1 +1  0;
        -1 +1  0;
         0 -1 +1;
        -1  0 +1;
        +1  0 +1;
         0 +1 +1;
         0  0 -1;
         0 -1  0;
        -1  0  0;
        +1  0  0;
         0 +1  0;
         0  0 +1;
         0  0  0];  
     
P2i = (P2+1)*0.5;
tfgP2i = tfgP2*2-1;

indP2 = [1
     3
     9
     7
    19
    21
    27
    25
     2
     4
    10
     6
    12
     8
    18
    16
    20
    22
    24
    26
     5
    11
    13
    15
    17
    23
    14]';

for i = 1:27
    ind(i) = find(ismember(tfgP2, P2i(i,:),'rows'));
end

s = P2(:,1)';
t = P2(:,2)';
u = P2(:,3)';

% syms s t u

shapes = [(s.*t.*u.^2)./8.0+(s.*t.^2.*u)./8.0+(s.^2.*t.*u)./8.0-(s.*t.^2.*u.^2)./8.0-(s.^2.*t.*u.^2)./8.0-(s.^2.*t.^2.*u)./8.0-(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
s.*t.*u.^2.*(-1.0./8.0)-(s.*t.^2.*u)./8.0+(s.^2.*t.*u)./8.0+(s.*t.^2.*u.^2)./8.0-(s.^2.*t.*u.^2)./8.0-(s.^2.*t.^2.*u)./8.0+(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
(s.*t.*u.^2)./8.0-(s.*t.^2.*u)./8.0-(s.^2.*t.*u)./8.0+(s.*t.^2.*u.^2)./8.0+(s.^2.*t.*u.^2)./8.0-(s.^2.*t.^2.*u)./8.0-(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
s.*t.*u.^2.*(-1.0./8.0)+(s.*t.^2.*u)./8.0-(s.^2.*t.*u)./8.0-(s.*t.^2.*u.^2)./8.0+(s.^2.*t.*u.^2)./8.0-(s.^2.*t.^2.*u)./8.0+(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
(s.*t.*u.^2)./8.0-(s.*t.^2.*u)./8.0-(s.^2.*t.*u)./8.0-(s.*t.^2.*u.^2)./8.0-(s.^2.*t.*u.^2)./8.0+(s.^2.*t.^2.*u)./8.0+(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
s.*t.*u.^2.*(-1.0./8.0)+(s.*t.^2.*u)./8.0-(s.^2.*t.*u)./8.0+(s.*t.^2.*u.^2)./8.0-(s.^2.*t.*u.^2)./8.0+(s.^2.*t.^2.*u)./8.0-(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
(s.*t.*u.^2)./8.0+(s.*t.^2.*u)./8.0+(s.^2.*t.*u)./8.0+(s.*t.^2.*u.^2)./8.0+(s.^2.*t.*u.^2)./8.0+(s.^2.*t.^2.*u)./8.0+(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
s.*t.*u.^2.*(-1.0./8.0)-(s.*t.^2.*u)./8.0+(s.^2.*t.*u)./8.0-(s.*t.^2.*u.^2)./8.0+(s.^2.*t.*u.^2)./8.0+(s.^2.*t.^2.*u)./8.0-(s.*t.*u)./8.0+(s.^2.*t.^2.*u.^2)./8.0;
(t.^2.*u.^2)./4.0+(t.*u)./4.0-(t.*u.^2)./4.0-(t.^2.*u)./4.0-(s.^2.*t.*u)./4.0+(s.^2.*t.*u.^2)./4.0+(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*u.^2)./4.0+(s.*u)./4.0-(s.*u.^2)./4.0-(s.^2.*u)./4.0-(s.*t.^2.*u)./4.0+(s.*t.^2.*u.^2)./4.0+(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*t.^2)./4.0+(s.*t)./4.0-(s.*t.^2)./4.0-(s.^2.*t)./4.0-(s.*t.*u.^2)./4.0+(s.*t.^2.*u.^2)./4.0+(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*u.^2)./4.0-(s.*u)./4.0+(s.*u.^2)./4.0-(s.^2.*u)./4.0+(s.*t.^2.*u)./4.0-(s.*t.^2.*u.^2)./4.0+(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*t.^2)./4.0-(s.*t)./4.0+(s.*t.^2)./4.0-(s.^2.*t)./4.0+(s.*t.*u.^2)./4.0-(s.*t.^2.*u.^2)./4.0+(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(t.^2.*u.^2)./4.0-(t.*u)./4.0+(t.*u.^2)./4.0-(t.^2.*u)./4.0+(s.^2.*t.*u)./4.0-(s.^2.*t.*u.^2)./4.0+(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*t.^2)./4.0+(s.*t)./4.0+(s.*t.^2)./4.0+(s.^2.*t)./4.0-(s.*t.*u.^2)./4.0-(s.*t.^2.*u.^2)./4.0-(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*t.^2)./4.0-(s.*t)./4.0-(s.*t.^2)./4.0+(s.^2.*t)./4.0+(s.*t.*u.^2)./4.0+(s.*t.^2.*u.^2)./4.0-(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(t.^2.*u.^2)./4.0-(t.*u)./4.0-(t.*u.^2)./4.0+(t.^2.*u)./4.0+(s.^2.*t.*u)./4.0+(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*u.^2)./4.0-(s.*u)./4.0-(s.*u.^2)./4.0+(s.^2.*u)./4.0+(s.*t.^2.*u)./4.0+(s.*t.^2.*u.^2)./4.0-(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(s.^2.*u.^2)./4.0+(s.*u)./4.0+(s.*u.^2)./4.0+(s.^2.*u)./4.0-(s.*t.^2.*u)./4.0-(s.*t.^2.*u.^2)./4.0-(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
(t.^2.*u.^2)./4.0+(t.*u)./4.0+(t.*u.^2)./4.0+(t.^2.*u)./4.0-(s.^2.*t.*u)./4.0-(s.^2.*t.*u.^2)./4.0-(s.^2.*t.^2.*u)./4.0-(s.^2.*t.^2.*u.^2)./4.0;
u.*(-1.0./2.0)-(s.^2.*u.^2)./2.0-(t.^2.*u.^2)./2.0+(s.^2.*u)./2.0+(t.^2.*u)./2.0+u.^2./2.0-(s.^2.*t.^2.*u)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
t.*(-1.0./2.0)-(s.^2.*t.^2)./2.0-(t.^2.*u.^2)./2.0+(s.^2.*t)./2.0+(t.*u.^2)./2.0+t.^2./2.0-(s.^2.*t.*u.^2)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
s.*(-1.0./2.0)-(s.^2.*t.^2)./2.0-(s.^2.*u.^2)./2.0+(s.*t.^2)./2.0+(s.*u.^2)./2.0+s.^2./2.0-(s.*t.^2.*u.^2)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
s./2.0-(s.^2.*t.^2)./2.0-(s.^2.*u.^2)./2.0-(s.*t.^2)./2.0-(s.*u.^2)./2.0+s.^2./2.0+(s.*t.^2.*u.^2)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
t./2.0-(s.^2.*t.^2)./2.0-(t.^2.*u.^2)./2.0-(s.^2.*t)./2.0-(t.*u.^2)./2.0+t.^2./2.0+(s.^2.*t.*u.^2)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
u./2.0-(s.^2.*u.^2)./2.0-(t.^2.*u.^2)./2.0-(s.^2.*u)./2.0-(t.^2.*u)./2.0+u.^2./2.0+(s.^2.*t.^2.*u)./2.0+(s.^2.*t.^2.*u.^2)./2.0;
s.^2.*t.^2+s.^2.*u.^2+t.^2.*u.^2-s.^2-t.^2-u.^2-s.^2.*t.^2.*u.^2+1.0;
];

%%
tfgP3 = [-1.0000   -1.0000   -1.0000
   -0.3333   -1.0000   -1.0000
    0.3333   -1.0000   -1.0000
    1.0000   -1.0000   -1.0000
   -1.0000   -0.3333   -1.0000
   -0.3333   -0.3333   -1.0000
    0.3333   -0.3333   -1.0000
    1.0000   -0.3333   -1.0000
   -1.0000    0.3333   -1.0000
   -0.3333    0.3333   -1.0000
    0.3333    0.3333   -1.0000
    1.0000    0.3333   -1.0000
   -1.0000    1.0000   -1.0000
   -0.3333    1.0000   -1.0000
    0.3333    1.0000   -1.0000
    1.0000    1.0000   -1.0000
   -1.0000   -1.0000   -0.3333
   -0.3333   -1.0000   -0.3333
    0.3333   -1.0000   -0.3333
    1.0000   -1.0000   -0.3333
   -1.0000   -0.3333   -0.3333
   -0.3333   -0.3333   -0.3333
    0.3333   -0.3333   -0.3333
    1.0000   -0.3333   -0.3333
   -1.0000    0.3333   -0.3333
   -0.3333    0.3333   -0.3333
    0.3333    0.3333   -0.3333
    1.0000    0.3333   -0.3333
   -1.0000    1.0000   -0.3333
   -0.3333    1.0000   -0.3333
    0.3333    1.0000   -0.3333
    1.0000    1.0000   -0.3333
   -1.0000   -1.0000    0.3333
   -0.3333   -1.0000    0.3333
    0.3333   -1.0000    0.3333
    1.0000   -1.0000    0.3333
   -1.0000   -0.3333    0.3333
   -0.3333   -0.3333    0.3333
    0.3333   -0.3333    0.3333
    1.0000   -0.3333    0.3333
   -1.0000    0.3333    0.3333
   -0.3333    0.3333    0.3333
    0.3333    0.3333    0.3333
    1.0000    0.3333    0.3333
   -1.0000    1.0000    0.3333
   -0.3333    1.0000    0.3333
    0.3333    1.0000    0.3333
    1.0000    1.0000    0.3333
   -1.0000   -1.0000    1.0000
   -0.3333   -1.0000    1.0000
    0.3333   -1.0000    1.0000
    1.0000   -1.0000    1.0000
   -1.0000   -0.3333    1.0000
   -0.3333   -0.3333    1.0000
    0.3333   -0.3333    1.0000
    1.0000   -0.3333    1.0000
   -1.0000    0.3333    1.0000
   -0.3333    0.3333    1.0000
    0.3333    0.3333    1.0000
    1.0000    0.3333    1.0000
   -1.0000    1.0000    1.0000
   -0.3333    1.0000    1.0000
    0.3333    1.0000    1.0000
    1.0000    1.0000    1.0000];

P3 = [-1 -1 -1;
        +1 -1 -1;
        +1 +1 -1;
        -1 +1 -1;
        -1 -1 +1;
        +1 -1 +1;
        +1 +1 +1;
        -1 +1 +1;
        
         -1/3 -1 -1;
         1/3 -1 -1;
        -1  1/3 -1;
        -1  -1/3 -1;
        -1 -1  -1/3;
        -1 -1  1/3;
        +1  -1/3 -1;
        +1  1/3 -1;
        +1 -1  -1/3;
        +1 -1  1/3;
         1/3 +1 -1;
         -1/3 +1 -1;
        +1 +1  -1/3;
        +1 +1  1/3;
        -1 +1  -1/3;
        -1 +1  1/3;
         -1/3 -1 +1;
         1/3 -1 +1;
        -1  1/3 +1;
        -1  -1/3 +1;
        +1  -1/3 +1;
        +1  1/3 +1;
         1/3 +1 +1;
         -1/3 +1 +1;
         
         -1/3 -1/3 -1;
         +1/3 -1/3 -1;
         +1/3 +1/3 -1;
         -1/3 +1/3 -1;
         
         -1/3 -1  -1/3;
         +1/3 -1  -1/3;
         +1/3 -1  +1/3;
         -1/3 -1  +1/3;
         
        -1  -1/3  -1/3;
        -1  +1/3  -1/3;
        -1  +1/3  +1/3;
        -1  -1/3  +1/3;
        
        +1  -1/3  -1/3;
        +1  +1/3  -1/3;
        +1  +1/3  +1/3;
        +1  -1/3  +1/3;
        
         +1/3 +1  -1/3;
         -1/3 +1  -1/3;
         -1/3 +1  +1/3;
         +1/3 +1  +1/3;
         
         -1/3 -1/3 +1;
         +1/3 -1/3 +1;
         +1/3 +1/3 +1;
         -1/3 +1/3 +1;
         
         -1/3 -1/3 -1/3;
         +1/3 -1/3 -1/3;
         +1/3 +1/3 -1/3;
         -1/3 +1/3 -1/3;
         -1/3 -1/3 +1/3;
         +1/3 -1/3 +1/3;
         +1/3 +1/3 +1/3;
         -1/3 +1/3 +1/3];  
     
P3i = round((P3+1)*0.5,5);
tfgP3i = (tfgP3+1)/2;

indP3 = [1
     4
    16
    13
    49
    52
    64
    61
     2
     3
     9
     5
    17
    33
     8
    12
    20
    36
    15
    14
    32
    48
    29
    45
    50
    51
    57
    53
    56
    60
    63
    62
     6
     7
    11
    10
    18
    19
    35
    34
    21
    25
    41
    37
    24
    28
    44
    40
    31
    30
    46
    47
    54
    55
    59
    58
    22
    23
    27
    26
    38
    39
    43
    42]';

for i = 1:64
    ind3(i) = find(ismember(round(tfgP3i,3), round(P3i(i,:),3),'rows'));
end

s = P3(:,1)';
t = P3(:,2)';
u = P3(:,3)';

% syms s t u

shapes = [
];
